/*! matchbox - v0.0.0 - 2014-05-13
* https://github.com/gpbmike/matchbox
* Copyright (c) 2014 Mike Horn; Licensed MIT */
!function(){"use strict";DS.FirebaseSerializer=DS.JSONSerializer.extend(),DS.FirebaseAdapter=DS.Adapter.extend({init:function(){if(!this.firebase||"object"!=typeof this.firebase)throw new Error("Please set the `firebase` property on the adapter.");this._ref=this.firebase.ref(),this._findAllMapForType={}},generateIdForRecord:function(){return this._ref.push().name()},find:function(a,b,c){var d=!1,e=this._getRef(b,c),f=a.serializerFor(b);return new Ember.RSVP.Promise(function(g,h){e.on("value",function(i){var j=i.val();d?j?a.getById(b.typeKey,c).setProperties(f.extractSingle(a,b,j)).save():a.getById(b.typeKey,c).destroyRecord():(d=!0,j?(j.id=i.name(),Ember.run(null,g,j)):(e.off(),Ember.run(null,h,"No result found for "+i.ref().toString())))},function(a){d||Ember.run(null,h,a)})},"DS: FirebaseAdapter#find "+b+" to "+e.toString())},findAll:function(a,b){function c(c){if(f){var d=c.val();d.id=c.name(),a.push(b,h.extractSingle(a,b,d))}}function d(c){f&&a.hasRecordForId(b,c.name())&&a.getById(b,c.name()).setProperties(h.extractSingle(a,b,c.val())).save()}function e(c){f&&a.hasRecordForId(b,c.name())&&a.deleteRecord(a.getById(b,c.name()))}var f=!1,g=this._getRef(b),h=a.serializerFor(b),i=this;return new Ember.RSVP.Promise(function(a,h){function j(a){f||(f=!0,Ember.run(null,h,a))}function k(b){f=!0;var c=Ember.A([]);b.forEach(function(a){var b=a.val();b.id=a.name(),c.push(b)}),Ember.run(null,a,c)}Ember.isNone(i._findAllMapForType[b])&&(i._findAllMapForType[b]=!0,g.on("child_added",c,j),g.on("child_changed",d,j),g.on("child_removed",e,j)),g.once("value",k,j)},"DS: FirebaseAdapter#findAll "+b+" to "+g.toString())},createRecord:function(a,b,c){var d=c.serialize({includeId:!1}),e=this._getRef(b,c.id);return new Ember.RSVP.Promise(function(a,b){e.set(d,function(c){c?Ember.run(null,b,c):Ember.run(null,a)})},"DS: FirebaseAdapter#createRecord "+b+" to "+e.toString())},updateRecord:function(){return this.createRecord.apply(this,arguments)},deleteRecord:function(a,b,c){var d=this._getRef(b,c.id);return new Ember.RSVP.Promise(function(a,b){d.remove(function(c){c?Ember.run(null,b,c):Ember.run(null,a)})},"DS: FirebaseAdapter#deleteRecord "+b+" to "+d.toString())},pathForType:function(a){var b=Ember.String.camelize(a);return Ember.String.pluralize(b)},_getRef:function(a,b){var c=this._ref;return a&&(c=c.child(this.pathForType(a.typeKey))),b&&(c=c.child(b)),c},_findAllMapForType:void 0})}();